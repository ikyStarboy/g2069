---
--- Generated by PluginCreator
--- new_game_report mainLua
--- DateTime:2023-04-20
---

require "common.entity_new_game_report"
require "common.event_new_game_report"
require "common.define_new_game_report"
require "common.report.report_attr_new_game_report"

if World.isClient then
    require "client.player.player_new_game_report"
    require "client.player.packet_new_game_report"
    require "client.entity.entity_new_game_report"
    require "client.entity.entity_value_func_new_game_report"
    require "client.gm_new_game_report"
else
    require "server.player.player_new_game_report"
    require "server.player.packet_new_game_report"
    require "server.entity.entity_new_game_report"
    require "server.gm_new_game_report"

    local initManager = function()
        ---@type GameReportManagerServer
        local GameReportManagerServer = require "server.manager.game_report_manager"
        GameReportManagerServer:instance():init()
    end

    initManager()
end

local handlers = {}

--function handlers.openXXXWnd()
	--TODO
--end
if World.isClient then
    Lib.subscribeEvent(Event.EVENT_OPEN_WINDOW, function(uiName)
        if World.cfg.reportSetting and World.cfg.reportSetting.newUIOpen and World.cfg.reportSetting.newUIOpen[uiName] then
            local wnd = UI:getWnd(uiName, true)
            wnd.openTime = os.time()
            Plugins.CallTargetPluginFunc("report", "report", "ui_open", { ui_name = uiName})
        end
    end)

    Lib.subscribeEvent(Event.EVENT_CLOSE_WINDOW, function(uiName)
        if World.cfg.reportSetting and World.cfg.reportSetting.newUIClose and World.cfg.reportSetting.newUIClose[uiName] then
            local wnd = UI:getWnd(uiName, true)
            if wnd.openTime then
                local uiTime = 0
                uiTime = os.time() - wnd.openTime
                Plugins.CallTargetPluginFunc("report", "report", "ui_close", { ui_name = uiName, open_time = uiTime})
            end
        end
    end)
else
    ---@type GameReportManagerServer
    local GameReportManagerServer = require "server.manager.game_report_manager"

    function handlers.playLimitedTimeGoldWheel(player, activityId)
        GameReportManagerServer:instance():reportPlayLimitedTimeGoldWheel(player, activityId)
    end
end

return function(name, ...)
	if type(handlers[name]) ~= "function" then
		return
	end
	return handlers[name](...)
end
