---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by hlm.
--- DateTime: 2021/6/2 12:06
---

local self = AsyncProcess
local strfmt = string.format
local cjson = require("cjson")

local function safeDecodeJSON(content,def)
    if content == "" then
        return def or false
    end
    local ok, ret = xpcall(cjson.decode, debug.traceback, content)
    if not ok then
        print("json decode fail:",content)
        return def or false
    end
    return ret
end


-- 保存用户游戏数据
function AsyncProcess.G2060SavePlayerGameSpecialData(userId, dataStr, callback)
    local url = strfmt("%s/gameaide/api/v1/inner/game/user/data/save/%s", self.ServerHttpHost, userId)
    local params = {}
    local body = {
        gameId= World.GameName ,
        data = cjson.encode(dataStr)  ,
    }
    self.HttpRequest("POST", url, params, function (response, isSuccess)
        if not isSuccess then
            Lib.logWarning("G2060SavePlayerGameSpecialData Error: " , response.code)
            if callback then
                callback(false)
            end
            return
        end
        --Lib.logWarning("G2060SavePlayerGameSpecialData success: " , Lib.v2s(response))
        if callback then
            callback(true)
        end
    end, body, true)
end

-- 批量获取用户游戏数据
function AsyncProcess.G2060GetPlayerGameSpecialData(userIds, callback)
    local url = strfmt("%s/gameaide/api/v1/inner/game/user/data/list/%s", self.ServerHttpHost, World.GameName)
    local params = {}
    local body = userIds
    self.HttpRequest("POST", url, params, function (response, isSuccess)
        if not isSuccess then
            --perror("G2060GetPlayerGameSpecialData:Error parma:",Lib.v2s(userIds,2))
            --if callback then
            --    callback(false)
            --end
            return
        end
        if callback then
            for _,val in pairs(response.data) do
                val.data = safeDecodeJSON( val.data,{})
            end
            callback(response.data)
        end
    end, body, true)
end
