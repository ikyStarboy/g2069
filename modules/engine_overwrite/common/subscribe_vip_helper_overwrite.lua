---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Administrator.
--- DateTime: 2023/6/9 18:00
---

---@type SubscribeVipHelper
local SubscribeVipHelper = SubscribeVipHelper

if World.isClient then
    -- 客户端请求领取奖励
    function SubscribeVipHelper:clientClickSubscribeVipReward()
        local subscribeVipStage = Me:getSubscribeVipStage()
        if subscribeVipStage == Define.SubscribeVIPStage.Normal or
                subscribeVipStage == Define.SubscribeVIPStage.Height then
            local subscribeRewardState = Me:getSubscribeRewardState()
            if not subscribeRewardState[Define.SubscribeVIPStage.Normal] then
                Me:requestSubscribeVipReward()
            end
        end
    end

    -- 客户端显示领取奖励结果
    function SubscribeVipHelper:ShowClientDistributeResult(resultCode, items)
        if resultCode == 0 then -- 成功
            local subscribeVipStage = Me:getSubscribeVipStage()
            if subscribeVipStage == Define.SubscribeVIPStage.Normal or
                    subscribeVipStage == Define.SubscribeVIPStage.Height then
                UI:openWindow("UI/game_role_common/gui/win_subscribe_ability_wnd")
            end
        end
    end

    function SubscribeVipHelper:checkSubscribeMainBtnRedState()
        local subscribeRewardState = Me:getSubscribeRewardState()
        local subscribeVipStage = Me:getSubscribeVipStage()
        if subscribeVipStage == Define.SubscribeVIPStage.Height or
                subscribeVipStage == Define.SubscribeVIPStage.Normal then
            if subscribeRewardState[Define.SubscribeVIPStage.Normal] then
                self:updateSubscribeMainBtnRedDot(false)
            else
                self:updateSubscribeMainBtnRedDot(true)
            end
        else
            self:updateSubscribeMainBtnRedDot(false)
        end
    end

    -- 更新订阅按钮红点显示
    function SubscribeVipHelper:updateSubscribeMainBtnRedDot(value)
        Lib.emitEvent(Event.EVENT_GAME_UPDATE_SUBSCRIBE_RED_SHOW, value)
    end
else
    -- 订阅VIP阶段数据更新,处理奖励
    function SubscribeVipHelper:dealSubscribeStateReward(player)
        local subscribeGameState = player:getSubscribeGameState()
        local subscribe_vipSetting = World.cfg.subscribe_vipSetting
        if subscribeGameState and subscribe_vipSetting.abilityExpBuffId then
            player:updateSkillBuffById(subscribe_vipSetting.abilityExpBuffId, true)
        else
            player:updateSkillBuffById(subscribe_vipSetting.abilityExpBuffId, false)
        end
    end
end