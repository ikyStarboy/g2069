---
--- Generated by PluginCreator
--- monster_manager entity
--- DateTime:2023-03-01
---

local Entity = Entity
local EntityServer = EntityServer
--buff key:
--function Entity.EntityProp:xxx(value, add, buff)
--end


function Entity:resetHurtRecord()
    self.hurtRecordList = {}
end

function Entity:getHurtProportion()
    local totalHurt = 0
    for objID, damage in pairs(self.hurtRecordList or {}) do
        totalHurt = totalHurt + damage
    end
    local hurtProportion = {}
    for objID, damage in pairs(self.hurtRecordList or {}) do
        local ratio = damage/totalHurt
        if ratio >= 0.9 then
            table.insert(hurtProportion, {objID = objID, ratio = 1})
        elseif ratio >= 0.8 then
            table.insert(hurtProportion, {objID = objID, ratio = 0.9})
        elseif ratio >= 0.7 then
            table.insert(hurtProportion, {objID = objID, ratio = 0.8})
        elseif ratio >= 0.6 then
            table.insert(hurtProportion, {objID = objID, ratio = 0.7})
        elseif ratio >= 0.5 then
            table.insert(hurtProportion, {objID = objID, ratio = 0.6})
        elseif ratio >= 0.4 then
            table.insert(hurtProportion, {objID = objID, ratio = 0.5})
        elseif ratio >= 0.3 then
            table.insert(hurtProportion, {objID = objID, ratio = 0.4})
        elseif ratio >= 0.2 then
            table.insert(hurtProportion, {objID = objID, ratio = 0.3})
        elseif ratio >= 0.1 then
            table.insert(hurtProportion, {objID = objID, ratio = 0.2})
        elseif ratio >= 0.05 then
            table.insert(hurtProportion, {objID = objID, ratio = 0.1})
        end
    end
    return hurtProportion
end

function Entity:addOneHurtRecord(attacker, damage)
    if self.objID == attacker.objID then
        return
    end
    if not self.hurtRecordList then
        self.hurtRecordList = {}
    end
    if not self.hurtRecordList[attacker.objID] then
        self.hurtRecordList[attacker.objID] = damage
    else
        self.hurtRecordList[attacker.objID] = self.hurtRecordList[attacker.objID] + damage
    end
end