---
--- Generated by PluginCreator
--- game_common gm
--- DateTime:2023-02-24
---

local path = Root.Instance():getGamePath():gsub("\\", "/") .. "lua/gm_server.lua"
local file, err = io.open(path, "r")
local GMItem
if file then
    GMItem = require("gm_server")
    file:close()
end
if not GMItem then
    GMItem = GM:createGMItem()
end

--GMItem["g2069/Resurrection Effect"] = function(self)
--    self:addBuff("myplugin/revive_effect_buff", 20)
--end

GMItem["g2069/Number of jumps"] = GM:inputStr(function(self, value)
    if not World.cfg.openGM then
        return
    end
    self:setMaxJumpCount(tonumber(value))
end)

GMItem["g2069/Creatin Test Monster"] = function(self)
    if not World.cfg.openGM then
        return
    end
    ---@type MonsterBornHelper
    local MonsterBornHelper = T(Lib, "MonsterBornHelper")

    if  MonsterBornHelper.testMonster and MonsterBornHelper.testMonster:isValid() then
        MonsterBornHelper.testMonster:stopAI()
        MonsterBornHelper.testMonster:destroy()
    end
    local params = {
        map = self.map,
        cfgName = "myplugin/monster_enel",
        ry = 0,
        rp = 0
    }
    local myPos = self:getPosition()
    params.pos = Lib.v3(myPos.x, myPos.y, myPos.z + 1)
    MonsterBornHelper.testMonster = EntityServer.Create(params)

    MonsterBornHelper.testMonster:data("main").regionBirthMap = self.map
    MonsterBornHelper.testMonster:data("main").regionBirthPos = params.pos
    MonsterBornHelper.testMonster:data("main").regionMaxDis = 9999
    MonsterBornHelper.testMonster:data("main").regionMaxHeight = 9999

    self:sendPacket({
        pid = "PushClientShowTips",
        text = "测试怪物已经生成"
    })
end

GMItem["g2069/targetPos test"] = function(self)
    if not World.cfg.openGM then
        return
    end
    ---@type MonsterBornHelper
    local MonsterBornHelper = T(Lib, "MonsterBornHelper")

    if  MonsterBornHelper.testMonster and MonsterBornHelper.testMonster:isValid() then
        MonsterBornHelper.testMonster:stopAI()
        MonsterBornHelper.testMonster:destroy()
    end
    local params = {
        map = self.map,
        cfgName = "myplugin/monster_lv30",
        ry = 0,
        rp = 0
    }
    params.pos = Lib.v3(33, 2.2, 26)
    MonsterBornHelper.testMonster = EntityServer.Create(params)

    self:sendPacket({
        pid = "PushClientShowTips",
        text = "测试怪物已经生成"
    })

    if self.testMonsterTimer then
        self.testMonsterTimer()
        self.testMonsterTimer = nil
    end

    MonsterBornHelper.testMonster:stopAI()
    self.testMonsterTimer = World.Timer(2,function()
        local pos1 = self:getPosition()
        local control = MonsterBornHelper.testMonster:getAIControl()
        control:setTargetPos(pos1, true)
        return true
    end)
end

GMItem["g2069/Test Monster Death"] = function(self)
    if not World.cfg.openGM then
        return
    end
    ---@type MonsterBornHelper
    local MonsterBornHelper = T(Lib, "MonsterBornHelper")
    ---@type BattleManagerServer
    local BattleManagerServer = require "server.manager.battle_manager"

    if  MonsterBornHelper.testMonster then
        BattleManagerServer:directAttack(self, MonsterBornHelper.testMonster, 100000)
    end


    if self.testMonsterTimer then
        self.testMonsterTimer()
        self.testMonsterTimer = nil
    end

    local control = MonsterBornHelper.testMonster:getAIControl()
    if control then
        control:setTargetPos()
        MonsterBornHelper.testMonster:stopAI()
    end
end